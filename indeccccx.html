<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è°ƒæŸ¥é—®å·è½¬æ¢å™¨ - å›ºå®šé¢„è§ˆåŒºåŸŸç‰ˆ</title>
  
  <!-- å¼•å…¥Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- å¼•å…¥Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwindé…ç½® -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#64748b',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444',
            info: '#06b6d4',
            light: '#f8fafc',
            dark: '#1e293b'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      .btn-hover {
        @apply transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5;
      }
      .text-gradient {
        background-clip: text;
        -webkit-background-clip: text;
        color: transparent;
      }
      .view-transition {
        transition: opacity 0.3s ease, transform 0.3s ease;
      }
      .panel-transition {
        transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
      }
    }
  </style>
</head>
<body class="font-inter bg-gray-50 text-gray-800 min-h-screen flex flex-col">
  <main class="flex-grow container mx-auto px-4 py-8 md:py-12">
    <!-- é¦–é¡µè§†å›¾ -->
    <div id="home-view" class="view active">
      <!-- ä»‹ç»å¡ç‰‡ -->
      <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 mb-8 shadow-md">
        <h2 class="text-2xl md:text-3xl font-bold mb-4 text-gray-800">
          å¼ºå¤§çš„è°ƒæŸ¥é—®å·è½¬æ¢å·¥å…·
        </h2>
        <p class="text-lg text-gray-600 mb-6 max-w-3xl">
          å°†æ–‡æœ¬æ ¼å¼çš„è°ƒæŸ¥é—®å·å¿«é€Ÿè½¬æ¢ä¸ºäº¤äº’å¼ç½‘é¡µè¡¨å•ï¼Œæ”¯æŒå¤šç§é—®é¢˜ç±»å‹ï¼Œå®æ—¶é¢„è§ˆï¼Œæ•°æ®æ”¶é›†ä¸å¯¼å‡ºã€‚
        </p>
        <div class="flex flex-wrap gap-4">
          <div class="flex items-center">
            <i class="fa fa-bolt text-primary text-xl mr-2"></i>
            <span class="text-gray-700">å¿«é€Ÿè½¬æ¢</span>
          </div>
          <div class="flex items-center">
            <i class="fa fa-magic text-primary text-xl mr-2"></i>
            <span class="text-gray-700">å¤šç§é¢˜å‹</span>
          </div>
          <div class="flex items-center">
            <i class="fa fa-mobile text-primary text-xl mr-2"></i>
            <span class="text-gray-700">å“åº”å¼è®¾è®¡</span>
          </div>
          <div class="flex items-center">
            <i class="fa fa-database text-primary text-xl mr-2"></i>
            <span class="text-gray-700">æ•°æ®å¯¼å‡º</span>
          </div>
        </div>
      </div>

      <!-- ä¸»å·¥ä½œåŒº -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
        <!-- ç¼–è¾‘å™¨åŒºåŸŸ -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 hover:shadow-lg">
          <div class="bg-primary p-4">
            <h2 class="text-xl font-bold text-white flex items-center">
              <i class="fa fa-edit mr-2"></i> è¾“å…¥è°ƒæŸ¥é—®å·æ–‡æœ¬
            </h2>
          </div>
          <div class="p-5">
            <div class="relative mb-5">
              <div class="absolute inset-0 border-2 border-primary/30 rounded-lg pointer-events-none transition-all duration-300"></div>
              <textarea id="editor" placeholder="è¯·åœ¨æ­¤è¾“å…¥è°ƒæŸ¥é—®å·æ–‡æœ¬..." 
                class="w-full h-64 p-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all resize-none"></textarea>
            </div>
            
            <div class="flex flex-wrap gap-3 mb-5">
              <button id="convert-btn" class="px-6 py-3 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg flex items-center btn-hover">
                <i class="fa fa-magic mr-2"></i> è½¬æ¢è°ƒæŸ¥é—®å·
              </button>
              <button id="clear-btn" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg flex items-center btn-hover">
                <i class="fa fa-trash mr-2"></i> æ¸…ç©º
              </button>
              <button id="example-btn" class="px-6 py-3 bg-info hover:bg-info/90 text-white font-medium rounded-lg flex items-center btn-hover">
                <i class="fa fa-lightbulb-o mr-2"></i> åŠ è½½ç¤ºä¾‹
              </button>
            </div>
            
            <div class="bg-gray-50 p-4 rounded-lg mb-5">
              <h3 class="font-semibold mb-2 text-gray-700">æ ¼å¼è¯´æ˜:</h3>
              <ul class="text-sm text-gray-600 space-y-1 list-disc pl-5">
                <li>ç¬¬ä¸€è¡Œä¸ºé—®å·æ ‡é¢˜</li>
                <li>ç¬¬äºŒè¡Œå¼€å§‹ä¸ºè¯´æ˜æ–‡å­—ï¼ˆå¯é€‰ï¼‰</li>
                <li>é—®é¢˜æ ¼å¼: <code class="bg-gray-200 px-1 py-0.5 rounded text-xs">1. é—®é¢˜æ–‡æœ¬[radio|checkbox|dropdown|textarea]</code></li>
                <li>é€‰é¡¹æ ¼å¼: <code class="bg-gray-200 px-1 py-0.5 rounded text-xs">a) é€‰é¡¹æ–‡æœ¬</code></li>
              </ul>
            </div>
            
            <div class="flex flex-wrap gap-3">
              <button id="set-survey-btn" class="px-5 py-2.5 bg-secondary hover:bg-secondary/90 text-white font-medium rounded-lg flex items-center btn-hover">
                <i class="fa fa-download mr-2"></i> æ¥æ”¶é—®å·æ–‡æœ¬
              </button>
            </div>
            
            <div id="editor-error" class="mt-3 text-danger text-sm hidden">
              <i class="fa fa-exclamation-circle mr-1"></i>
              <span></span>
            </div>
            
            <!-- ç»“æœé¢æ¿ -->
            <div id="results-panel" class="mt-6 bg-gray-50 rounded-lg border border-gray-200 overflow-hidden panel-transition">
              <div class="bg-gray-100 p-3 flex justify-between items-center border-b border-gray-200 cursor-pointer" id="results-panel-header">
                <h3 class="font-semibold text-gray-700">å¡«å†™ç»“æœ (æ–‡æœ¬æ ¼å¼)</h3>
                <button id="toggle-results-btn" class="text-gray-500 hover:text-gray-700 transition-colors">
                  <i class="fa fa-chevron-down"></i>
                </button>
              </div>
              <div id="results-content" class="p-4 max-h-0 overflow-hidden transition-all duration-300">
                <pre id="results-text" class="text-sm font-mono bg-white p-3 rounded border border-gray-200 overflow-x-auto h-64"></pre>
              </div>
            </div>
          </div>
        </div>
        
        <!-- é¢„è§ˆåŒºåŸŸ -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 hover:shadow-lg">
          <div class="bg-info p-4">
            <h2 class="text-xl font-bold text-white flex items-center">
              <i class="fa fa-eye mr-2"></i> è°ƒæŸ¥é—®å·é¢„è§ˆ
            </h2>
          </div>
          <div class="p-5">
            <div id="preview-container" class="bg-gray-50 rounded-lg p-5 border border-gray-200 overflow-y-auto max-h-[600px]">
              <div class="text-center text-gray-400 h-full flex flex-col items-center justify-center">
                <i class="fa fa-file-text-o text-5xl mb-3 block"></i>
                <p class="text-lg">è¯·ç‚¹å‡»"è½¬æ¢è°ƒæŸ¥é—®å·"æŒ‰é’®ç”Ÿæˆé—®å·</p>
              </div>
            </div>
            
            <div id="preview-error" class="mt-3 text-danger text-sm hidden">
              <i class="fa fa-exclamation-circle mr-1"></i>
              <span></span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- åŠŸèƒ½è¯´æ˜ -->
      <div class="mt-12 bg-white rounded-xl shadow-md p-6">
        <h2 class="text-2xl font-bold mb-6 text-gray-800">åŠŸèƒ½ç‰¹ç‚¹</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-blue-50 p-5 rounded-lg border border-blue-100 transition-all duration-300 hover:shadow-md">
            <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4">
              <i class="fa fa-code text-primary text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2 text-gray-800">ç®€æ˜“æ–‡æœ¬æ ¼å¼</h3>
            <p class="text-gray-600">ä½¿ç”¨ç®€å•çš„æ–‡æœ¬æ ¼å¼ç¼–å†™é—®å·ï¼Œæ”¯æŒå¤šç§é—®é¢˜ç±»å‹ï¼ŒåŒ…æ‹¬å•é€‰é¢˜ã€å¤šé€‰é¢˜ã€ä¸‹æ‹‰èœå•å’Œæ–‡æœ¬é¢˜ã€‚</p>
          </div>
          
          <div class="bg-green-50 p-5 rounded-lg border border-green-100 transition-all duration-300 hover:shadow-md">
            <div class="w-12 h-12 bg-success/10 rounded-full flex items-center justify-center mb-4">
              <i class="fa fa-mobile text-success text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2 text-gray-800">å“åº”å¼è®¾è®¡</h3>
            <p class="text-gray-600">ç”Ÿæˆçš„é—®å·åœ¨å„ç§è®¾å¤‡ä¸Šéƒ½èƒ½å®Œç¾æ˜¾ç¤ºï¼Œä»æ‰‹æœºåˆ°æ¡Œé¢ç”µè„‘éƒ½æœ‰è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p>
          </div>
          
          <div class="bg-purple-50 p-5 rounded-lg border border-purple-100 transition-all duration-300 hover:shadow-md">
            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mb-4">
              <i class="fa fa-plug text-purple-600 text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2 text-gray-800">APIæ¥å£</h3>
            <p class="text-gray-600">æä¾›ç®€å•çš„JavaScript APIï¼Œå¯è½»æ¾é›†æˆåˆ°å…¶ä»–ç³»ç»Ÿä¸­ï¼Œå®ç°é—®å·çš„åŠ¨æ€åŠ è½½å’Œç»“æœæ”¶é›†ã€‚</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- JavaScript -->
  <script>
    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      // ========== æ–°å¢ï¼šURL å‚æ•°è‡ªåŠ¨åŠ è½½åŠŸèƒ½ ==========
      
      // æ£€æŸ¥ URL å‚æ•°
      function getUrlParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
      }
      
      // è‡ªåŠ¨åŠ è½½é—®å· - æ”¯æŒå¤šç§å‚æ•°æ ¼å¼
      function autoLoadSurvey() {
        console.log('ğŸ” å¼€å§‹æ£€æŸ¥ URL å‚æ•°...');
        console.log('å½“å‰ URL:', window.location.href);
        
        // æ–¹æ³•1: æ£€æŸ¥ survey å‚æ•°ï¼ˆåŸç‰ˆ Base64ï¼‰
        const surveyParam = getUrlParameter('survey');
        console.log('survey å‚æ•°:', surveyParam ? `å­˜åœ¨ï¼Œé•¿åº¦: ${surveyParam.length}` : 'ä¸å­˜åœ¨');
        
        if (surveyParam) {
          try {
            console.log('ğŸš€ å°è¯•è§£ç  survey å‚æ•°...');
            console.log('åŸå§‹å‚æ•°å‰100å­—ç¬¦:', surveyParam.substring(0, 100));
            
            // ä¿®æ­£çš„è§£ç æ–¹å¼ï¼šç›´æ¥ Base64 è§£ç ï¼Œä¸ç”¨ URL è§£ç 
            const base64Decoded = atob(surveyParam);
            
            console.log('âœ… è§£ç æˆåŠŸï¼');
            console.log('ğŸ“ è§£ç åçš„æ–‡æœ¬é•¿åº¦:', base64Decoded.length);
            console.log('ğŸ“ è§£ç åçš„æ–‡æœ¬å‰100å­—ç¬¦:', base64Decoded.substring(0, 100));
            
            // å¡«å…¥ç¼–è¾‘å™¨
            document.getElementById('editor').value = base64Decoded;
            
            showAutoLoadNotification('é—®å·å·²è‡ªåŠ¨åŠ è½½ï¼æ­£åœ¨è½¬æ¢...', 'success');
            
            // è‡ªåŠ¨è½¬æ¢
            setTimeout(() => {
              console.log('ğŸ”„ å¼€å§‹è‡ªåŠ¨è½¬æ¢...');
              const convertBtn = document.getElementById('convert-btn');
              if (convertBtn) {
                convertBtn.click();
                showAutoLoadNotification('é—®å·è½¬æ¢å®Œæˆï¼', 'success');
              } else {
                console.error('âŒ æ‰¾ä¸åˆ°è½¬æ¢æŒ‰é’®');
              }
            }, 1000);
            
            return true;
          } catch (error) {
            console.error('âŒ survey å‚æ•°è§£ç å¤±è´¥:', error);
            console.log('é”™è¯¯è¯¦æƒ…:', error.message);
            
            // å°è¯•å¤‡ç”¨è§£ç æ–¹å¼
            try {
              console.log('ğŸ”„ å°è¯•å¤‡ç”¨è§£ç æ–¹å¼...');
              const urlDecoded = decodeURIComponent(surveyParam);
              const base64Decoded = atob(urlDecoded);
              
              document.getElementById('editor').value = base64Decoded;
              showAutoLoadNotification('é—®å·å·²è‡ªåŠ¨åŠ è½½ï¼ˆå¤‡ç”¨æ–¹å¼ï¼‰ï¼æ­£åœ¨è½¬æ¢...', 'success');
              
              setTimeout(() => {
                document.getElementById('convert-btn').click();
                showAutoLoadNotification('é—®å·è½¬æ¢å®Œæˆï¼', 'success');
              }, 1000);
              
              return true;
            } catch (error2) {
              console.error('âŒ å¤‡ç”¨è§£ç æ–¹å¼ä¹Ÿå¤±è´¥:', error2);
              showAutoLoadNotification('é—®å·è§£ç å¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ ¼å¼', 'error');
            }
          }
        }
        
        // æ–¹æ³•2: æ£€æŸ¥ data å‚æ•°ï¼ˆV2 ç»“æ„åŒ–æ•°æ®ï¼‰
        const dataParam = getUrlParameter('data');
        const autoParam = getUrlParameter('auto');
        if (dataParam) {
          try {
            // è§£ç ç»“æ„åŒ–æ•°æ®
            const decodedJson = decodeURIComponent(atob(dataParam));
            const surveyData = JSON.parse(decodedJson);
            
            // å°†ç»“æ„åŒ–æ•°æ®è½¬æ¢å›æ–‡æœ¬æ ¼å¼
            const surveyText = convertStructuredToText(surveyData);
            document.getElementById('editor').value = surveyText;
            
            showAutoLoadNotification('ç»“æ„åŒ–é—®å·å·²è‡ªåŠ¨åŠ è½½ï¼æ­£åœ¨è½¬æ¢...', 'success');
            
            // è‡ªåŠ¨è½¬æ¢
            setTimeout(() => {
              document.getElementById('convert-btn').click();
              showAutoLoadNotification('é—®å·è½¬æ¢å®Œæˆï¼', 'success');
            }, 1000);
            
            return true; // æˆåŠŸåŠ è½½
          } catch (error) {
            console.error('data å‚æ•°åŠ è½½å¤±è´¥:', error);
          }
        }
        
        // æ–¹æ³•3: æ£€æŸ¥ text å‚æ•°ï¼ˆç®€åŒ–ç‰ˆç›´æ¥æ–‡æœ¬ï¼‰
        const textParam = getUrlParameter('text');
        const modeParam = getUrlParameter('mode');
        if (textParam) {
          try {
            // ç›´æ¥è§£ç æ–‡æœ¬
            const decodedText = decodeURIComponent(textParam);
            document.getElementById('editor').value = decodedText;
            
            showAutoLoadNotification('æ–‡æœ¬é—®å·å·²è‡ªåŠ¨åŠ è½½ï¼æ­£åœ¨è½¬æ¢...', 'success');
            
            // è‡ªåŠ¨è½¬æ¢
            setTimeout(() => {
              document.getElementById('convert-btn').click();
              showAutoLoadNotification('é—®å·è½¬æ¢å®Œæˆï¼', 'success');
            }, 1000);
            
            return true; // æˆåŠŸåŠ è½½
          } catch (error) {
            console.error('text å‚æ•°åŠ è½½å¤±è´¥:', error);
          }
        }
        
        // å¦‚æœæ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥
        if (surveyParam || dataParam || textParam) {
          showAutoLoadNotification('é—®å·æ ¼å¼æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥é“¾æ¥', 'error');
        }
        
        return false;
      }
      
      // å°†ç»“æ„åŒ–æ•°æ®è½¬æ¢å›æ–‡æœ¬æ ¼å¼
      function convertStructuredToText(surveyData) {
        let text = surveyData.title + '\n\n';
        
        surveyData.questions.forEach((question, index) => {
          text += `${question.number || (index + 1)}. ${question.question}`;
          
          // æ·»åŠ é¢˜å‹æ ‡è®°
          if (question.type) {
            text += `[${question.type}]`;
          }
          
          text += '\n';
          
          // æ·»åŠ é€‰é¡¹
          if (question.options && question.options.length > 0) {
            question.options.forEach((option, optIndex) => {
              const letter = String.fromCharCode(97 + optIndex); // a, b, c, d...
              text += `${letter}) ${option}\n`;
            });
          }
          
          text += '\n';
        });
        
        return text.trim();
      }
      
      // æ˜¾ç¤ºè‡ªåŠ¨åŠ è½½é€šçŸ¥
      function showAutoLoadNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 transition-all duration-300 ${
          type === 'success' ? 'bg-green-500' : 
          type === 'error' ? 'bg-red-500' : 'bg-blue-500'
        }`;
        notification.innerHTML = `
          <div class="flex items-center">
            <i class="fa fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'} mr-2"></i>
            <span>${message}</span>
          </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.opacity = '0';
          setTimeout(() => {
            if (document.body.contains(notification)) {
              document.body.removeChild(notification);
            }
          }, 300);
        }, 3000);
      }
      
      // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ URL å‚æ•°
      autoLoadSurvey();
      
      // ========== ä»¥ä¸‹æ˜¯ä½ çš„åŸæœ‰ä»£ç ï¼Œä¿æŒä¸å˜ ==========
      
      // å¯¼èˆªæ æ»šåŠ¨æ•ˆæœ
      const navbar = document.getElementById('navbar');
      window.addEventListener('scroll', function() {
        if (window.scrollY > 10) {
          navbar.classList.add('py-2');
          navbar.classList.add('shadow-lg');
        } else {
          navbar.classList.remove('py-2');
          navbar.classList.remove('shadow-lg');
        }
      });
      
      // åŠ è½½ç¤ºä¾‹é—®å·
      document.getElementById('example-btn').addEventListener('click', function() {
        const exampleSurvey = `ç”¨æˆ·æ»¡æ„åº¦è°ƒæŸ¥
è¯·å¯¹æˆ‘ä»¬çš„äº§å“è¿›è¡Œè¯„ä»·
1. æ‚¨å¯¹äº§å“çš„æ•´ä½“æ»¡æ„åº¦å¦‚ä½•ï¼Ÿ[radio]
a) éå¸¸æ»¡æ„
b) æ»¡æ„
c) ä¸€èˆ¬
d) ä¸æ»¡æ„
2. æ‚¨è®¤ä¸ºæˆ‘ä»¬çš„äº§å“æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰[checkbox]
a) åŠŸèƒ½ä¸°å¯Œ
b) ç•Œé¢ç¾è§‚
c) æ“ä½œç®€å•
d) æ€§èƒ½ç¨³å®š
e) ä»·æ ¼åˆç†
3. æ‚¨æœ€å¸¸ä½¿ç”¨çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿ[dropdown]
a) æ•°æ®ç»Ÿè®¡
b) æŠ¥å‘Šç”Ÿæˆ
c) æ•°æ®å¯¼å…¥å¯¼å‡º
d) ç”¨æˆ·ç®¡ç†
4. æ‚¨å¯¹æˆ‘ä»¬çš„äº§å“æœ‰ä»€ä¹ˆå»ºè®®ï¼Ÿ[textarea]`;
        
        document.getElementById('editor').value = exampleSurvey;
        hideError('editor-error');
      });
      
      // æ¸…ç©ºç¼–è¾‘å™¨
      document.getElementById('clear-btn').addEventListener('click', function() {
        document.getElementById('editor').value = '';
        hideError('editor-error');
      });
      
      // è½¬æ¢è°ƒæŸ¥é—®å·
      document.getElementById('convert-btn').addEventListener('click', function() {
        const surveyText = document.getElementById('editor').value.trim();
        
        if (!surveyText) {
          showError('editor-error', 'è¯·è¾“å…¥è°ƒæŸ¥é—®å·å†…å®¹');
          return;
        }
        
        try {
          const survey = parseSurvey(surveyText);
          renderSurvey(survey);
          hideError('editor-error');
          hideError('preview-error');
          // é‡ç½®ç»“æœé¢æ¿
          resetResultsPanel();
        } catch (error) {
          showError('preview-error', error.message);
        }
      });
      
      // æ¥æ”¶é—®å·æ–‡æœ¬
      document.getElementById('set-survey-btn').addEventListener('click', function() {
        const surveyText = prompt('è¯·è¾“å…¥è°ƒæŸ¥é—®å·æ–‡æœ¬:');
        if (surveyText !== null) {
          document.getElementById('editor').value = surveyText;
          hideError('editor-error');
        }
      });
      
      // è§£æè°ƒæŸ¥é—®å·æ–‡æœ¬
      function parseSurvey(text) {
        const lines = text.split('\n').map(line => line.trim());
        if (lines.length === 0) {
          throw new Error('è°ƒæŸ¥é—®å·å†…å®¹ä¸èƒ½ä¸ºç©º');
        }
        
        const survey = {
          title: lines[0],
          description: '',
          questions: []
        };
        
        let currentQuestion = null;
        let inDescription = true;
        
        // å­˜å‚¨å®Œæ•´çš„è°ƒæŸ¥é—®å·æ–‡æœ¬ï¼Œç”¨äºç»“æœæ˜¾ç¤º
        survey.fullText = text;
        
        for (let i = 1; i < lines.length; i++) {
          const line = lines[i];
          
          // ç©ºè¡Œè·³è¿‡
          if (!line) continue;
          
          // é—®é¢˜è¡Œ
          const questionMatch = line.match(/^(\d+)\.\s+(.*?)\[(radio|checkbox|dropdown|textarea)\]$/);
          if (questionMatch) {
            inDescription = false;
            const questionNumber = questionMatch[1];
            const questionText = questionMatch[2];
            const questionType = questionMatch[3];
            
            currentQuestion = {
              number: questionNumber,
              text: questionText,
              type: questionType,
              options: []
            };
            
            survey.questions.push(currentQuestion);
            continue;
          }
          
          // é€‰é¡¹è¡Œ
          if (currentQuestion && (currentQuestion.type === 'radio' || currentQuestion.type === 'checkbox' || currentQuestion.type === 'dropdown')) {
            const optionMatch = line.match(/^([a-z])\)\s+(.*)$/);
            if (optionMatch) {
              const optionKey = optionMatch[1];
              const optionText = optionMatch[2];
              
              currentQuestion.options.push({
                key: optionKey,
                text: optionText
              });
              continue;
            }
          }
          
          // æè¿°è¡Œ
          if (inDescription) {
            survey.description += (survey.description ? '\n' : '') + line;
          }
        }
        
        if (survey.questions.length === 0) {
          throw new Error('è°ƒæŸ¥é—®å·ä¸­æœªæ‰¾åˆ°é—®é¢˜');
        }
        
        return survey;
      }
      
      // æ¸²æŸ“è°ƒæŸ¥é—®å·
      function renderSurvey(survey) {
        const container = document.getElementById('preview-container');
        container.innerHTML = '';
        
        // å­˜å‚¨è°ƒæŸ¥é—®å·å¯¹è±¡ï¼Œç”¨äºç»“æœæ˜¾ç¤º
        window.currentSurvey = survey;
        
        // åˆ›å»ºé—®å·æ ‡é¢˜
        const titleElement = document.createElement('h2');
        titleElement.className = 'text-2xl font-bold mb-4 text-gray-800';
        titleElement.textContent = survey.title;
        container.appendChild(titleElement);
        
        // åˆ›å»ºé—®å·æè¿°
        if (survey.description) {
          const descriptionElement = document.createElement('p');
          descriptionElement.className = 'text-gray-600 mb-6';
          descriptionElement.textContent = survey.description;
          container.appendChild(descriptionElement);
        }
        
        // åˆ›å»ºé—®é¢˜è¡¨å•
        const formElement = document.createElement('form');
        formElement.id = 'survey-form';
        container.appendChild(formElement);
        
        // åˆ›å»ºé—®é¢˜
        survey.questions.forEach((question, index) => {
          const questionContainer = document.createElement('div');
          questionContainer.className = 'mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200';
          formElement.appendChild(questionContainer);
          
          // åˆ›å»ºé—®é¢˜æ ‡é¢˜
          const questionTitle = document.createElement('h3');
          questionTitle.className = 'text-lg font-semibold mb-3 text-gray-800';
          questionTitle.textContent = `${question.number}. ${question.text}`;
          questionContainer.appendChild(questionTitle);
          
          // æ ¹æ®é—®é¢˜ç±»å‹åˆ›å»ºä¸åŒçš„è¾“å…¥æ§ä»¶
          switch (question.type) {
            case 'radio':
            case 'checkbox':
              question.options.forEach(option => {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'mb-2 flex items-center';
                
                const input = document.createElement('input');
                input.type = question.type;
                input.id = `q${question.number}_${option.key}`;
                input.name = `question${question.number}`;
                input.value = option.key;
                input.className = 'mr-2 h-4 w-4 text-primary focus:ring-primary border-gray-300';
                
                const label = document.createElement('label');
                label.htmlFor = `q${question.number}_${option.key}`;
                label.className = 'text-gray-700';
                label.textContent = option.text;
                
                inputGroup.appendChild(input);
                inputGroup.appendChild(label);
                questionContainer.appendChild(inputGroup);
              });
              break;
              
            case 'dropdown':
              const select = document.createElement('select');
              select.name = `question${question.number}`;
              select.className = 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary';
              
              // æ·»åŠ é»˜è®¤é€‰é¡¹
              const defaultOption = document.createElement('option');
              defaultOption.value = '';
              defaultOption.textContent = 'è¯·é€‰æ‹©...';
              defaultOption.selected = true;
              defaultOption.disabled = true;
              select.appendChild(defaultOption);
              
              // æ·»åŠ é€‰é¡¹
              question.options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option.key;
                optionElement.textContent = option.text;
                select.appendChild(optionElement);
              });
              
              questionContainer.appendChild(select);
              break;
              
            case 'textarea':
              const textarea = document.createElement('textarea');
              textarea.name = `question${question.number}`;
              textarea.rows = 4;
              textarea.className = 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary';
              textarea.placeholder = 'è¯·è¾“å…¥æ‚¨çš„å›ç­”...';
              questionContainer.appendChild(textarea);
              break;
          }
        });
        
        // æ·»åŠ æäº¤æŒ‰é’®
        const submitButton = document.createElement('button');
        submitButton.type = 'submit';
        submitButton.id = 'submit-survey';
        submitButton.className = 'mt-4 px-6 py-3 bg-success hover:bg-success/90 text-white font-medium rounded-lg flex items-center btn-hover mx-auto';
        submitButton.innerHTML = '<i class="fa fa-check mr-2"></i> æäº¤é—®å·';
        
        // æ·»åŠ è¡¨å•æäº¤äº‹ä»¶å¤„ç†
        formElement.addEventListener('submit', function(event) {
          event.preventDefault(); // é˜»æ­¢é»˜è®¤æäº¤è¡Œä¸º
          
          const results = getSurveyResults();
          if (Object.keys(results).length === 0) {
            alert('é—®å·ä¸ºç©ºæˆ–æœªå¡«å†™ä»»ä½•å†…å®¹');
            return;
          }
          
          showResults(results);
        });
        
        formElement.appendChild(submitButton);
      }
      
      // è·å–è°ƒæŸ¥é—®å·ç»“æœ
      function getSurveyResults() {
        const form = document.getElementById('survey-form');
        if (!form) return {};
        
        const results = {};
        const elements = form.elements;
        
        for (let i = 0; i < elements.length; i++) {
          const element = elements[i];
          if (element.name.startsWith('question')) {
            const questionNumber = element.name.replace('question', '');
            
            if (element.type === 'radio' || element.type === 'checkbox') {
              if (element.checked) {
                if (!results[questionNumber]) {
                  results[questionNumber] = element.type === 'checkbox' ? [] : '';
                }
                
                if (element.type === 'checkbox') {
                  results[questionNumber].push(element.value);
                } else {
                  results[questionNumber] = element.value;
                }
              }
            } else {
              if (element.value) {
                results[questionNumber] = element.value;
              }
            }
          }
        }
        
        return results;
      }
      
      // å°†ç»“æœæ ¼å¼åŒ–ä¸ºæ–‡æœ¬
      function formatResultsAsText(results) {
        const survey = window.currentSurvey;
        if (!survey) {
          return "æ— æ³•è·å–è°ƒæŸ¥é—®å·ä¿¡æ¯";
        }
        
        let text = `${survey.title}\n\n`;
        
        if (survey.description) {
          text += `${survey.description}\n\n`;
        }
        
        text += "å›ç­”ç»“æœ:\n\n";
        
        for (const questionNumber in results) {
          const answer = results[questionNumber];
          const question = survey.questions.find(q => q.number === questionNumber);
          
          if (!question) continue;
          
          text += `${question.number}. ${question.text}\n`;
          
          if (question.type === 'radio' || question.type === 'checkbox' || question.type === 'dropdown') {
            if (Array.isArray(answer)) {
              // å¤šé€‰é¢˜
              text += "- é€‰æ‹©äº†:\n";
              answer.forEach(optionKey => {
                const option = question.options.find(o => o.key === optionKey);
                if (option) {
                  text += `  - ${option.text}\n`;
                }
              });
            } else {
              // å•é€‰é¢˜æˆ–ä¸‹æ‹‰èœå•
              const option = question.options.find(o => o.key === answer);
              if (option) {
                text += `- é€‰æ‹©äº†: ${option.text}\n`;
              }
            }
          } else {
            // æ–‡æœ¬é¢˜
            text += `- å›ç­”: ${answer}\n`;
          }
          
          text += "\n";
        }
        
        return text;
      }
      
      // æ˜¾ç¤ºç»“æœ
      function showResults(results) {
        // å°†ç»“æœæ ¼å¼åŒ–ä¸ºæ–‡æœ¬
        const resultsText = formatResultsAsText(results);
        
        // æ›´æ–°ç¼–è¾‘å™¨å†…å®¹
        document.getElementById('editor').value = resultsText;
        
        // æ›´æ–°ç»“æœé¢æ¿
        document.getElementById('results-text').textContent = resultsText;
        
        // æ˜¾ç¤ºç»“æœé¢æ¿
        const resultsPanel = document.getElementById('results-panel');
        resultsPanel.classList.remove('max-h-0', 'opacity-0', 'p-0');
        resultsPanel.classList.add('max-h-[500px]', 'opacity-100', 'p-0');
        
        // å±•å¼€ç»“æœå†…å®¹
        setTimeout(() => {
          document.getElementById('results-content').style.maxHeight = '500px';
          document.getElementById('toggle-results-btn').innerHTML = '<i class="fa fa-chevron-up"></i>';
        }, 10);
        
        // æ˜¾ç¤ºæç¤º
        alert('è°ƒæŸ¥é—®å·ç»“æœå·²æ”¶é›†å¹¶æ˜¾ç¤ºåœ¨ç¼–è¾‘å™¨å’Œç»“æœé¢æ¿ä¸­');
        console.log('è°ƒæŸ¥é—®å·ç»“æœ:', results);
      }
      
      // é‡ç½®ç»“æœé¢æ¿
      function resetResultsPanel() {
        const resultsContent = document.getElementById('results-content');
        resultsContent.style.maxHeight = '0';
        
        const resultsPanel = document.getElementById('results-panel');
        resultsPanel.classList.add('max-h-0', 'opacity-0', 'p-0');
        resultsPanel.classList.remove('max-h-[500px]', 'opacity-100', 'p-0');
        
        document.getElementById('toggle-results-btn').innerHTML = '<i class="fa fa-chevron-down"></i>';
      }
      
      // åˆ‡æ¢ç»“æœé¢æ¿
      document.getElementById('results-panel-header').addEventListener('click', function() {
        const resultsContent = document.getElementById('results-content');
        const toggleBtn = document.getElementById('toggle-results-btn');
        
        if (resultsContent.style.maxHeight === '0px' || !resultsContent.style.maxHeight) {
          resultsContent.style.maxHeight = '500px';
          toggleBtn.innerHTML = '<i class="fa fa-chevron-up"></i>';
        } else {
          resultsContent.style.maxHeight = '0';
          toggleBtn.innerHTML = '<i class="fa fa-chevron-down"></i>';
        }
      });
      
      // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
      function showError(elementId, message) {
        const errorElement = document.getElementById(elementId);
        errorElement.querySelector('span').textContent = message;
        errorElement.classList.remove('hidden');
      }
      
      // éšè—é”™è¯¯ä¿¡æ¯
      function hideError(elementId) {
        const errorElement = document.getElementById(elementId);
        errorElement.classList.add('hidden');
      }
    });
  </script>
</body>
</html>
